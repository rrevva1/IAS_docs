# Роли и права доступа

Документ фиксирует матрицу доступа по ролям для MVP ИАС учёта технических средств.

## 1. Роли

| Код роли | Наименование   | Описание |
|----------|----------------|----------|
| admin    | Администратор  | Полный доступ к данным, настройкам, пользователям, учёту ТС, журналу аудита, импорту, справочнику ПО и лицензий. |
| operator | Оператор       | Доступ ко всем заявкам (просмотр, смена статуса, назначение исполнителя, комментарии). Доступ к перечню техники любого пользователя (для контекста заявки). Просмотр и редактирование карточек активов — по правилам (админ или ответственный). |
| user     | Пользователь   | Создание и просмотр собственных заявок; просмотр заявок, где пользователь назначен исполнителем. Просмотр только своей техники (get-user-equipment). |

## 2. Матрица по операциям

| Операция / объект        | Пользователь | Оператор | Администратор |
|--------------------------|-------------|----------|----------------|
| Заявки: просмотр списка  | Только свои | Все      | Все            |
| Заявки: просмотр одной   | Автор/исполнитель | Все | Все            |
| Заявки: создание         | Да          | Да       | Да             |
| Заявки: редактирование   | Автор/исполнитель | Все | Все            |
| Заявки: удаление         | Нет         | Нет      | Да             |
| Заявки: смена статуса, исполнителя, комментарий | По доступу к заявке | Да | Да |
| Вложения: скачивание/предпросмотр | По доступу к заявке | По доступу | По доступу |
| Техника пользователя (get-user-equipment) | Только свой userId | Любой userId | Любой userId |
| Учёт ТС: список          | Нет         | Нет      | Да             |
| Учёт ТС: карточка просмотр/редактирование | Нет | Ответственный за актив или админ | Да + ответственный |
| Учёт ТС: создание, архивирование | Нет | Нет | Да |
| Пользователи             | Только свой профиль | Только свой | Полный CRUD   |
| Журнал аудита            | Нет         | Нет      | Да             |
| Импорт ОУ                | Нет         | Нет      | Да             |
| ПО и лицензии            | Нет         | Нет      | Да             |

## 3. Проверка прав в коде

- Заявки: метод `TasksController::canUserAccessTask($task)` — автор, исполнитель, администратор или оператор.
- Удаление заявки: только администратор.
- Вложения: доступ к заявке через `canUserAccessTask` для задачи, к которой привязано вложение.
- Get-user-equipment: разрешено, если `userId == current user` или текущий пользователь — администратор или оператор.
- Учёт ТС (ArmController): список, создание, удаление, архивирование — только администратор; просмотр/редактирование карточки — администратор или ответственный за актив.
