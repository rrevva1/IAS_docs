# Структура листа «АРМ» файла «Основной Учет.xlsx»

Документ подготовлен по результатам разбора содержимого файла (workbook.xml, sharedStrings.xml, dimension листа АРМ).

## 1. Общие сведения

| Параметр | Значение |
|----------|----------|
| Файл | Основной Учет.xlsx |
| Лист | **АРМ** (первый лист в книге) |
| Диапазон | **A1:W792** (23 столбца, 1 строка заголовка + 791 строка данных) |
| Другие листы в книге | Принтеры; Поставки 2017-2019, 2020, 2021, 2022-1, 2022-2, 2023, 2024, 2025; СБ забрали; Принтеры забрали; Мониторы забрали |

## 2. Предполагаемые заголовки столбцов (по содержимому sharedStrings)

По порядку появления в файле типичные заголовки и связанные с ними данные:

| Столбец | Наименование / назначение | Примеры значений |
|---------|---------------------------|------------------|
| A | Наименование / тип техники | Системный блок, Ноутбук, Монитор, Моноблок, ИБП, Коммутатор |
| B | Поставщик | ООО "ГКС", ООО "Мира", ООО "МОЛВЕРС", Flextron |
| C | Дата поступления | — |
| D | Кому поставили | ФИО, «к. 508», «Отдали …» |
| E | Дата | — |
| F | Примечание | Свободный текст, статусы («Списать», «На складе») |
| G | Системный блок | Модель/описание СБ или инв. номер |
| H | ЦП | Core i5-7400 3,0 ГГц, Core i7-9700 3,0 ГГц, Celeron 2,66 ГГц |
| I | ОЗУ | 4 ГБ, 8 ГБ, 16 ГБ, **4 ГБ\n2 ГБ личные** (неатомарно) |
| J | Диск / накопители | 500 ГБ, 1 ТБ, SSD 240 ГБ, **80 ГБ\n2 ТБ**, **500 ГБ, 250 ГБ**, **512ГБ (SSD)\n2 ТБ**, **256 ГБ SSD\n2 ТБ HDD** (часто неатомарно) |
| K | Монитор | Модель/наименование, **Samsung S22C200\nSamsung S22C200**, **Dell U2415\nDell U2415** (часто 2 монитора в одной ячейке) |
| L | Пользователь | ФИО ответственного |
| M | Отдел | Подразделение |
| N | № монитора | Инв. номер монитора |
| O | № системн. блока | Инв. номер СБ |
| P | Инв. Номер | Общий инв. номер (00-000257, 99036, РБК6930 и т.д.) |
| Q | ОС | Win10 Pro (x64), Win7 Pro (x64), Astra Linux, KES |
| R | IP адрес | 10.2.2.47, **10.2.2.208\n10.0.73.178(VPN)** (возможны несколько в одной ячейке) |
| S | Имя | Имя ПК в сети (hostname) |
| T | Антивирус | KES, Kaspersky, Windows Defender |
| U | Помещение | Кабинет/локация: 505, 508, к. 702а, 409 б, 301-302 (Белый зал) |
| V–W | Доп. поля | По контексту — примечания, дубли инв. номеров, статусы |

Точное соответствие «буква столбца — заголовок» рекомендуется уточнить по первой строке листа в Excel или утилитой разбора Excel (по решению проекта).

## 3. Неатомарные ячейки (несколько значений в одной ячейке)

Во многих ячейках хранится **перечисление** значений. Разделители в файле: **перенос строки (\n)**, **запятая**, реже **« и »** или **точка с запятой**.

### 3.1. Типичные столбцы с неатомарным содержимым

| Столбец / атрибут | Содержимое | Примеры | Рекомендация при загрузке в БД |
|-------------------|------------|---------|----------------------------------|
| **Диск / накопители** | Несколько носителей у одного ПК | «80 ГБ\n2 ТБ», «500 ГБ, 250 ГБ», «512ГБ (SSD)\n2 ТБ», «HDD 500 ГБ\nHDD -500 ГБ», «2x4ТБ, 2x240ГБ» | Либо одно поле `description`/примечание с полным текстом; либо парсинг по разделителям (запятая, \n) и запись в `part_char_values`: несколько записей «Жесткий диск» с разными value_text (или одна запись с объединённым значением). |
| **Монитор** | Два и более монитора | «Samsung S22C200\nSamsung S22C200», «Philips 234E5QSB 23"\nPhilips 234E5QSB 23"», «Dell U2415\nDell U2415», «Samsung SyncMaster 931c\nBenq GL2450» | Аналогично: сохранить как текст в описании/характеристиках или разбить по строкам и создать несколько записей в справочнике характеристик (тип части «Монитор», значение — каждая строка). |
| **ОЗУ** | Объём + примечание или несколько значений | «4 ГБ\n2 ГБ личные» | Либо одно значение (первая строка или конкатенация), либо нормализация в справочник с одной записью «8 ГБ» и примечанием. |
| **IP адрес** | Несколько адресов (основной + VPN и т.д.) | «10.2.2.208\n10.0.73.178(VPN)», «10.10.10.1\n10.1.4.111» | Сохранить в одно поле (description или отдельное поле ip_address text); при необходимости парсить и хранить основной в отдельном атрибуте. |

### 3.2. Общие правила при загрузке

1. **Определить столбцы-источники** для полей БД: наименование/инв. номер (equipment.name), помещение (locations), пользователь (users), примечание (description), характеристики (spr_parts/spr_chars → part_char_values).
2. **Перед записью в БД** проверять ячейку на разделители (перенос строки, запятая, « и »):
   - если значение **атомарное** — использовать как есть для одного поля или одной записи в справочнике;
   - если **неатомарное** — выбрать стратегию:  
     - **вариант А:** сохранить весь текст в одно поле (например, description или value_text одной записи);  
     - **вариант Б:** разбить по разделителям и создать несколько записей (например, несколько строк в part_char_values для «Жесткий диск» / «Монитор»).
3. **Валидация:** проверять ссылки на пользователя и помещение (ФИО → users.full_name, название кабинета → locations.name); при отсутствии совпадения — создавать запись в справочнике или помечать строку для ручной обработки.
4. **Дубликаты:** определять уникальность АРМ по инв. номеру или по комбинации (наименование + пользователь + помещение); при повторе — обновлять существующую запись или пропускать с записью в лог.

## 4. Соответствие листа «АРМ» и таблиц БД (целевая схема)

| Данные в Excel (лист АРМ) | Таблица/поле БД | Примечание |
|---------------------------|------------------|------------|
| Наименование / № системн. блока / Инв. Номер | equipment.name | Один из столбцов или конкатенация; приоритет — инв. номер при наличии |
| Помещение (кабинет, локация) | locations.name → equipment.location_id | Поиск по названию; при отсутствии — создать локацию (тип «кабинет» или «другое») |
| Пользователь (ФИО) | users.full_name → equipment.user_id | Поиск по ФИО; при отсутствии — пропуск или создание пользователя |
| Примечание, статусы | equipment.description | Текст целиком; при необходимости обрезать по длине поля |
| Системный блок, ЦП, ОЗУ, Диск, Монитор, ОС, IP, Имя, Антивирус | part_char_values + spr_parts + spr_chars | Справочники типов частей и характеристик; при неатомарных ячейках — см. п. 3 |
| Дата поступления / Дата | equip_history или отдельное поле | При наличии — запись в equip_history (change_type «постановка на учёт», new_value = дата) |

## 5. Проверка структуры листа

Для уточнения структуры листа «АРМ» целесообразно:

- просмотреть первую строку (заголовки) и выборочные данные непосредственно в Excel;
- при необходимости — использовать утилиту разбора (по решению проекта), которая выводит заголовки столбцов, число непустых и неатомарных ячеек по столбцам и примеры неатомарных значений.

Результаты проверки при необходимости фиксируются в проектной документации.
