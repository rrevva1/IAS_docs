# Регламент: замена компонентов АРМ (монитор, ИПБ и т.д.)

Документ фиксирует **принцип учёта** и **порядок внесения изменений** в системе при замене техники у пользователя (например: один монитор из двух меняют, ИПБ меняют на другую марку или на ту же марку).

---

## 1. Принцип учёта в системе

- **Одна запись в таблице оборудования (equipment) = одна физическая единица техники.**
- У пользователя «системный блок + 2 монитора + ИПБ» в системе отображается как **четыре отдельные записи** с одним и тем же ответственным (`responsible_user_id`) и, как правило, одной локацией.
- Тип каждой единицы задаётся полем **тип техники** (системный блок, монитор, ИБП и т.д.).

Таким образом, замена **одного** монитора или **одного** ИПБ — это работа с **конкретной записью** (одним активом), а не с «компьютером целиком».

---

## 2. Где вносить изменения

| Действие | Раздел | Экран |
|----------|--------|--------|
| Найти технику пользователя | **Учет ТС** (или **Пользователи** → раскрыть строку «Техника работника») | Список активов с фильтром по ответственному / просмотр техники по пользователю |
| Открыть карточку актива | Учет ТС → клик по строке или по ссылке актива | **arm/view** — просмотр одной единицы техники |
| Редактировать актив | В карточке актива — «Редактирование» (или из списка Учет ТС) | **arm/update** — форма: инв. номер, название, тип, ответственный, локация, описание, характеристики по типу |

Итого: изменения вносятся **в карточке конкретного актива** (Редактирование), а не в «карточке пользователя». Карточка пользователя — это только сводный список закреплённой техники; редактирование каждой единицы — через Учет ТС → нужный актив → Редактирование.

---

## 3. Замена одного монитора (или одной единицы техники с изменением данных)

**Вариант А — правка существующей записи (подходит, когда меняют модель/марку и это нужно отразить в той же учётной единице):**

1. Учет ТС → найти нужного пользователя (фильтр по ответственному) или Пользователи → раскрыть «Техника работника».
2. Выбрать **тот самый монитор**, который заменяют (из двух записей «Монитор» — нужная одна).
3. Открыть карточку актива → **Редактирование**.
4. Изменить: название/модель, при необходимости инв. номер (если у нового монитора другой), описание, характеристики (например, диагональ). Сохранить.
5. В историю оборудования автоматически пишется событие **update** (изменение названия, инв. номера и т.д.).

**Вариант Б — списание старой единицы и постановка на учёт новой (если нужна явная история «старый снят — новый поставлен»):**

1. По **старому** монитору: карточка актива → **Архивировать** (указать причину, например «Замена на другой монитор»). Запись остаётся в БД с флагом «в архиве».
2. Учет ТС → **Создать** новую запись (тип «Монитор»), заполнить данные нового монитора, указать того же ответственного и локацию. Сохранить.
3. В истории: по старой записи — событие **archive**, новая запись получает событие **create**. Замена явно видна по двум записям и датам.

---

## 4. Замена ИПБ на другую марку

- ИПБ в системе учтён как **отдельная запись** с типом техники «ИБП» (или аналог).
- Действия те же, что для монитора:
  - **Вариант А:** открыть карточку **этого** ИПБ → Редактирование → изменить название/описание (например, с «ИБП APC Back-UPS 650» на «ИБП Eaton 3S 700»). Сохранить. Изменение видно и в карточке, и в истории (update).
  - **Вариант Б:** архивировать старый ИПБ (причина «Замена на другую марку»), создать новую запись с данными нового ИПБ и закрепить за тем же пользователем.

---

## 5. Замена ИПБ на ту же марку (внешне запись не меняется)

Если меняют физический прибор на такой же по марке/модели, изменение названия и описания в той же записи не отражает факт замены.

Рекомендуемые варианты:

1. **Описание (комментарий):** в карточке актива в поле «Описание» добавить запись вида: «Замена 12.02.2026, экземпляр тот же модели» (или с серийным номером нового экземпляра). При следующей замене можно дополнять текст. Изменение описания при сохранении можно доработать в системе так, чтобы в историю оборудования записывалось событие **update** с полем `description` (сейчас в событие update попадают в основном inventory_number и name).
2. **История оборудования:** при необходимости можно ввести отдельный тип события (например, **maintenance** или **replacement**) с комментарием «Замена ИПБ, та же марка, дата …». Тогда в карточке актива в блоке «История изменений» будет явная запись о замене даже без изменения названия.
3. **Архив + новая запись:** архивировать старый ИПБ с причиной «Замена на тот же модель, дата …», создать новую запись с теми же названием/маркой, но новым серийным номером (если известен) или пометкой в описании. Так замена однозначно видна по появлению новой записи и архивации старой.

---

## 6. Краткая схема

| Ситуация | Где менять | Действие |
|----------|------------|----------|
| Меняем один монитор, данные нового известны | Учет ТС → карточка **этого** монитора → Редактирование | Изменить название, инв. номер, описание, характеристики ИЛИ архивировать старый + создать новый |
| Меняем ИПБ на другую марку | Учет ТС → карточка **этого** ИПБ → Редактирование | Изменить название/описание ИЛИ архивировать старый + создать новый |
| Меняем ИПБ на ту же марку | Та же карточка ИПБ | Добавить в описание дату/факт замены; при необходимости — событие в истории или архив старой + новая запись |

Во всех случаях изменение делается **по конкретной единице техники** (одной записи equipment), а не по «комплекту» пользователя. Комплект (системный блок, 2 монитора, ИПБ) в интерфейсе собирается по общему ответственному и при необходимости по локации.
