# Спецификация API (эндпоинты для фронтенда)

Базовый URL: приложение развёрнуто по корню сайта; маршруты в формате `index.php?r=controller-id/action-id` или через pretty URL.

## 1. Заявки (Tasks)

| Метод | Маршрут / действие | Описание |
|-------|--------------------|----------|
| GET   | tasks/index        | Страница со списком заявок (AG Grid). |
| GET   | tasks/get-grid-data| JSON: список заявок для грида. Видимость по ролям (пользователь — свои, оператор/админ — все). Пагинация: клиентская (все записи). |
| GET   | tasks/view?id=     | Просмотр заявки. Права: canUserAccessTask. |
| POST  | tasks/change-status?id= | JSON. Тело: status_id. Смена статуса. |
| POST  | tasks/assign-executor?id= | JSON. Тело: executor_id. Назначение исполнителя. |
| POST  | tasks/update-comment?id= | JSON. Тело: comment. Обновление комментария. |
| GET   | tasks/download?id= | Скачивание вложения (id = id вложения). Проверка доступа к заявке. Заголовок X-Content-Type-Options: nosniff. |
| GET   | tasks/preview?id=  | Предпросмотр вложения. SVG и опасные типы — только скачивание. |
| GET   | tasks/get-user-equipment?userId= | JSON: перечень техники пользователя. Разрешено только для userId == текущий пользователь или администратор/оператор. |

## 2. Учёт ТС (Arm / Equipment)

| Метод | Маршрут / действие | Описание |
|-------|--------------------|----------|
| GET   | arm/index          | Страница со списком ТС (AG Grid). Только администратор. |
| GET   | arm/get-grid-data  | JSON: список оборудования с характеристиками из part_char_values. |
| GET   | arm/view?id=       | Карточка актива. Доступ: администратор или ответственный. |
| GET/POST | arm/update?id=   | Редактирование карточки актива. |
| POST  | arm/archive?id=    | Архивирование актива. Тело: archive_reason (опционально). |

## 3. Форматы ответов JSON

- Успех: `{ "success": true, "message": "...", "data": [...], "total": N }`.
- Ошибка: `{ "success": false, "message": "..." }`.
- Коды HTTP: 200 — успех, 403 — нет доступа, 404 — не найдено.

## 4. Режим AG Grid

По умолчанию: клиентская пагинация и фильтрация (сервер отдаёт все записи в get-grid-data). При росте объёма данных целесообразно ввести серверную пагинацию (параметры page, pageSize, sort, filter в запросе и соответствующая выборка в БД).
