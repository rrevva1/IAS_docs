# ОУ_тест.xlsx — первые 10 строк: что парсится и куда грузится

Документ фиксирует **приведённые к атомарному виду** значения по первым 10 строкам данных листа «АРМ» и однозначный маппинг в целевые таблицы БД.

**Единый источник правил по столбцам и особым значениям:** **[docs/РЕГЛАМЕНТ_ПАРСИНГА_ОУ_ТЕСТ.md](РЕГЛАМЕНТ_ПАРСИНГА_ОУ_ТЕСТ.md)**. При расхождении с данным файлом приоритет у регламента.

---

## Правила парсинга

1. **Разделитель неатомарных ячеек — только перенос строки (`\n`).**  
   Запятая в данных (например, «3,3 ГГц» в ЦП) **не** считается разделителем — это десятичный разделитель, значение ЦП хранится **целиком**.

2. **Столбцы, где возможны несколько значений в одной ячейке (разделитель `\n`):**
   - **Диск** — разбивать по `\n`; каждую подстроку грузить как отдельную запись в `part_char_values` (тип части «Накопитель», value_text = подстрока) или одну запись с объединённым value_text.
   - **Монитор** — аналогично: при `\n` несколько записей «Монитор» или одна с объединённым текстом.
   - **№ монитора**, **№ системн. блока** — при `\n`: первая подстрока в `equipment.inventory_number` (для строки-ПК), остальное при необходимости в description; для № монитора — part_char_values (несколько записей или одна).
   - **Дата закупки монитора** — при `\n` несколько дат/подстрок → примечание или несколько записей по регламенту.

3. **Помещение:** число (103, 105) приводить к строке `"103"`, `"105"` для `locations.name`.

4. **Столбец «Пароль на BIOS…»** — не загружаем.

5. **Итог по строке:** одна строка листа = одна запись **equipment** (один ПК или один монитор, если в строке только монитор). Инв. номер — из «№ системн. блока» или «№ монитора» по правилу «есть СБ — инв. из № системн. блока; только монитор — из № монитора». Конфигурация (ЦП, ОЗУ, Диск, Монитор, Имя, IP, ОС, Антивирус) → **part_char_values** для этого equipment_id.

---

## Маппинг столбца → куда грузится

| № | Столбец | Куда грузится |
|---|---------|----------------|
| 1 | Пользователь | users.full_name → equipment.responsible_user_id |
| 2 | Отдел | **пока не загружаем** (см. регламент: «Карточка оформлена» = статус карточки, не отдел; решение не принято) |
| 3 | Помещение | locations.name → equipment.location_id |
| 4 | ЦП | part_char_values: часть «ЦП», характеристика «Модель», value_text = **целиком** (без разбиения по запятой) |
| 5 | ОЗУ | part_char_values: ОЗУ, «Объём», value_text |
| 6 | Диск | part_char_values: Накопитель — при `\n` несколько записей (каждая подстрока) или одна value_text |
| 7 | Системный блок | equipment.name, equipment.equipment_type |
| 8 | Пароль на BIOS… | не загружаем |
| 9 | № системн. блока | equipment.inventory_number (при `\n` — первая подстрока) |
| 10 | Дата закупки системного блока | equipment.purchase_date (год → 01.01.YYYY, DD.MM.YYYY → date, текст → NULL или в description) |
| 11 | Монитор | part_char_values: Монитор, value_text (при `\n` — несколько записей или одна) |
| 12 | № монитора | part_char_values: № монитора, value_text |
| 13 | Дата закупки монитора | примечание / part_char_values |
| 14 | Имя | part_char_values: Имя ПК (hostname) |
| 15 | IP адрес | part_char_values: IP адрес |
| 16 | ОС | part_char_values: ОС |
| 17 | Антивирус | part_char_values: Антивирус |
| 18 | Другая техника | equipment.description или отдельная запись equipment (ИБП/принтер) |

---

## Строка данных 1 (строка листа 2)

- **Пользователь**  
  → значение: `Абрамова Дарья Алексанровна`  
  → загрузка: users.full_name → equipment.responsible_user_id

- **Отдел**  
  → значение: `Карточка оформлена`  
  → загрузка: **пока не загружаем** (статус «карточка подписана на оборудование», не отдел; см. регламент)

- **Помещение**  
  → значение: `103`  
  → загрузка: locations.name → equipment.location_id

- **ЦП**  
  → значение: `Pentium Dual-Core E6500 2,93 ГГц` *(атомарно, запятая — десятичный разделитель)*  
  → загрузка: part_char_values: ЦП, «Модель», value_text = целиком

- **ОЗУ**  
  → значение: `4 ГБ`  
  → загрузка: part_char_values: ОЗУ, «Объём», value_text

- **Диск**  
  → значение: `300 ГБ`  
  → загрузка: part_char_values: Накопитель, одна запись value_text

- **Системный блок**  
  → значение: `Треугольник`  
  → загрузка: equipment.name, equipment.equipment_type

- **Пароль на BIOS…**  
  → значение: `XXX`  
  → загрузка: не загружаем

- **№ системн. блока**  
  → значение: `190354`  
  → загрузка: equipment.inventory_number

- **Дата закупки системного блока**  
  → значение: `2008`  
  → загрузка: equipment.purchase_date (год → 2008-01-01 или по регламенту)

- **Монитор**  
  → значение: `Samsung SyncMaster SA200`  
  → загрузка: part_char_values: Монитор, value_text

- **№ монитора**  
  → значение: `МЦ.04.2`  
  → загрузка: part_char_values: № монитора, value_text

- **Дата закупки монитора**  
  → значение: `2012`  
  → загрузка: примечание/part_char_values

- **Имя**  
  → значение: `105-w7p64-11`  
  → загрузка: part_char_values: Имя ПК

- **IP адрес**  
  → значение: `192.168.20.11`  
  → загрузка: part_char_values: IP адрес

- **ОС**  
  → значение: `Win7 Pro (x64)`  
  → загрузка: part_char_values: ОС

- **Антивирус**  
  → значение: `KES11`  
  → загрузка: part_char_values: Антивирус

- **Другая техника**  
  → значение: *(пусто)*  
  → загрузка: не заполняем

---

## Строка данных 2 (строка листа 3)

- **Пользователь** → `Абрамова Дарья Алексанровна` → users.full_name → equipment.responsible_user_id  
- **Отдел** → `Карточка оформлена` → пока не загружаем (регламент)  
- **Помещение** → `103` → locations.name  
- **ЦП** → `Core i3-3220 3,3 ГГц` *(атомарно)* → part_char_values: ЦП, «Модель»  
- **ОЗУ** → `8 ГБ` → part_char_values: ОЗУ  
- **Диск** → `500 ГБ` → part_char_values: Накопитель  
- **Системный блок** → `USN Computers (mini)` → equipment.name, equipment_type  
- **Пароль на BIOS…** → не загружаем  
- **№ системн. блока** → `МЦ.04.2` → equipment.inventory_number  
- **Дата закупки системного блока** → `2013` (число) → equipment.purchase_date (2013-01-01)  
- **Монитор** → `Samsung SyncMaster SA200` → part_char_values: Монитор  
- **№ монитора** → `МЦ.04.2` → part_char_values: № монитора  
- **Дата закупки монитора** → `2012` → примечание/part_char_values  
- **Имя** → `105-W10p64-81` → part_char_values: Имя ПК  
- **IP адрес** → `10.1.4.81` → part_char_values: IP адрес  
- **ОС** → `Win10pro (x64)` → part_char_values: ОС  
- **Антивирус** → `KES11` → part_char_values: Антивирус  
- **Другая техника** → *(пусто)*

---

## Строка данных 3 (строка листа 4) — неатомарный «Диск»

- **Пользователь** → `Яшкина Елизавета Вячеславовна` → users → equipment.responsible_user_id  
- **Отдел** → `Карточка оформлена` → пока не загружаем (регламент)  
- **Помещение** → `103`  
- **ЦП** → `Core i3-3220 3,3 ГГц` *(атомарно)* → part_char_values: ЦП  
- **ОЗУ** → `8 ГБ` → part_char_values: ОЗУ  
- **Диск** *(неатомарно, разделитель \n)*  
  → исходная ячейка: `SSD 480 ГБ\nHDD 500 ГБ`  
  → **приведено к атомарным:**  
    - часть 1: `SSD 480 ГБ` → part_char_values: Накопитель, value_text = «SSD 480 ГБ»  
    - часть 2: `HDD 500 ГБ` → part_char_values: Накопитель, value_text = «HDD 500 ГБ»  
  → загрузка: **две записи** в part_char_values (один equipment_id, тип части «Накопитель», две строки с разным value_text)  
- **Системный блок** → `USN Computers (mini)` → equipment.name  
- **Пароль на BIOS…** → не загружаем  
- **№ системн. блока** → `МЦ.04.2` → equipment.inventory_number  
- **Дата закупки системного блока** → `2013` → equipment.purchase_date  
- **Монитор** → `BENQ BL2201M` → part_char_values: Монитор  
- **№ монитора** → `НИИСУ` → part_char_values: № монитора  
- **Дата закупки монитора** → `2012`  
- **Имя** → `105-w7u32-12`  
- **IP адрес** → `192.168.20.12`  
- **ОС** → `Win10Pro (x64)`  
- **Антивирус** → `KES11`  
- **Другая техника** → `ИБП Powercom RPT-1000A EURO` → equipment.description или отдельный equipment (ИБП)

---

## Строка данных 4 (строка листа 5)

- **Пользователь** → `Аптекарева Виктория Михайловна`  
- **Помещение** → `103`  
- **ЦП** → `Core i3-3220 3,3 ГГц` *(атомарно)*  
- **ОЗУ** → `8 ГБ`  
- **Диск** → `500 ГБ`  
- **Системный блок** → `USN Computers (mini)`  
- **№ системн. блока** → `МЦ.04.2` → equipment.inventory_number  
- **Дата закупки системного блока** → `2013` → equipment.purchase_date  
- **Монитор** → `Nec MultiSync E222W`  
- **№ монитора** → `НИИСУ`  
- **Дата закупки монитора** → `2009` (число) → 2009-01-01 или в примечание  
- **Имя** → `105-w7p64-10`, **IP** → `192.168.20.10`, **ОС** → `Win7 Pro (x64)`, **Антивирус** → `KES11`  
- **Другая техника** → *(пусто)*

---

## Строка данных 5 (строка листа 6)

- **Пользователь** → `Иваненко Константин Викторович`  
- **Помещение** → `105`  
- **ЦП** → `Core i5-9600K 3,7 ГГц` *(атомарно)*  
- **ОЗУ** → `16 ГБ`  
- **Диск** → `1 Тб`  
- **Системный блок** → `МИР4`  
- **№ системн. блока** → `00-000804` → equipment.inventory_number  
- **Дата закупки системного блока** → `18.06.2020` → equipment.purchase_date = 2020-06-18  
- **Монитор** → `Philips 23.8" 241B8QJEB`  
- **№ монитора** → `МЦ.04`  
- **Дата закупки монитора** → `27.12.2019` → 2019-12-27  
- **Имя** → `105-w10p64-47`, **IP** → `10.1.4.47`, **ОС** → `Win10 Pro (x64)`, **Антивирус** → `KES11`  
- **Другая техника** → `ИБП APC Back-UPS 650 ВА (BX650CI-RS)` → equipment.description или отдельный equipment

---

## Строка данных 6 (строка листа 7)

- **Пользователь** → `Тютчев Сергей Николаевич`  
- **Помещение** → `105`  
- **ЦП** → `Core i3-540 3,07 ГГц` *(атомарно)*  
- **ОЗУ** → `8 ГБ`, **Диск** → `1 ТБ`  
- **Системный блок** → `ARBYTE`  
- **№ системн. блока** → `МЦ.04.1` → equipment.inventory_number  
- **Дата закупки системного блока** → `2010`  
- **Монитор** → `Nec MultiSync E222W`, **№ монитора** → `МЦ.04.1`, **Дата закупки монитора** → `2009`  
- **Имя** → `105-w10p64-31`, **IP** → `10.1.4.31`, **ОС** → `Win10 Pro (x64)`, **Антивирус** → `KES12`

---

## Строка данных 7 (строка листа 8)

- **Пользователь** → `Котов Михаил Ювинальевич`  
- **Помещение** → `Пост охраны` → locations.name  
- **ЦП** → `Core i5-7400 3,0 ГГц` *(атомарно)*  
- **ОЗУ** → `8 ГБ`, **Диск** → `1 ТБ`  
- **Системный блок** → `ООО "ГКС" (ГИГАНТ)`  
- **Пароль на BIOS…** → *(пусто)* → не загружаем  
- **№ системн. блока** → `МЦ.04` → equipment.inventory_number  
- **Дата закупки системного блока** → `18.10.2017` → equipment.purchase_date = 2017-10-18  
- **Монитор** → `Samsung S22C200`, **№ монитора** → `МЦ.04.2`, **Дата закупки монитора** → `2013`  
- **Имя** → `ohr-W10Px64-1`, **IP адрес** → `не в сети` → part_char_values (как есть), **ОС** → `Win10 Pro (x64)`  
- **Антивирус** → *(пусто)*

---

## Строка данных 8 (строка листа 9) — моноблок

- **Пользователь** → `Патраков Василий Николаевич`  
- **Помещение** → `Пост охраны`  
- **ЦП** → `Core i3-4130 3,4 ГГц` *(атомарно)*  
- **ОЗУ** → `8 ГБ`, **Диск** → `500 ГБ`  
- **Системный блок** → `Моноблок HP EliteOne 800` → equipment.name, equipment_type = «Моноблок»  
- **№ системн. блока** → `МЦ.04` → equipment.inventory_number  
- **Дата закупки системного блока** → `2022 (б/у)` → purchase_date = NULL, текст в description или как есть  
- **Монитор** → `Моноблок` (встроенный) → part_char_values  
- **№ монитора**, **Дата закупки монитора** → *(пусто)*  
- **Имя** → `PostOhrani`, **IP** → *(пусто)*, **ОС** → `Win10 Pro (x64)`, **Антивирус** → `KES11`

---

## Строка данных 9 (строка листа 10) — только мониторы (неатомарно)

Строка **без** ЦП, ОЗУ, Диска, Системного блока — учитывается как **отдельная запись(и)** (монитор/мониторы) или пропуск по регламенту.

- **Пользователь** → `Котов Михаил Ювинальевич`  
- **Помещение** → `Пост охраны`  
- **ЦП, ОЗУ, Диск, Системный блок, № системн. блока, дата закупки СБ** → *(все пусто)*  
- **Монитор** *(неатомарно)*  
  → исходная ячейка: `AOC 24P2Q\nAOC 24P2Q`  
  → **приведено к атомарным:**  
    - часть 1: `AOC 24P2Q` → part_char_values: Монитор (или отдельная запись equipment для монитора)  
    - часть 2: `AOC 24P2Q` → часть 2  
  → загрузка: **две записи** «Монитор» в part_char_values **или** два equipment (тип «Монитор») — по регламенту  
- **№ монитора** *(неатомарно)*  
  → исходная ячейка: `МЦ.04\nМЦ.04`  
  → часть 1: `МЦ.04`, часть 2: `МЦ.04`  
  → загрузка: две записи в part_char_values или два equipment с inventory_number МЦ.04-&lt;суффикс&gt; для уникальности  
- **Дата закупки монитора** *(неатомарно)*  
  → исходная ячейка: `19.12.2022\n19.12.2022`  
  → часть 1: `19.12.2022`, часть 2: `19.12.2022`  
  → загрузка: примечание или две записи  
- **Имя, IP, ОС, Антивирус, Другая техника** → *(все пусто)*

**Вариант интерпретации:** одна строка = два монитора → две записи **equipment** (equipment_type = «Монитор», inventory_number = синтетический, например «МЦ.04-пост-1», «МЦ.04-пост-2») с одним responsible_user_id и location_id.

---

## Строка данных 10 (строка листа 11)

- **Пользователь** → `Печерский Виталий Васильевич`  
- **Помещение** → `Пост охраны`  
- **ЦП** → `Core i5-3330S 2,7 ГГц` *(атомарно)*  
- **ОЗУ** → `8 ГБ`, **Диск** → `500 ГБ`  
- **Системный блок** → `Моноблок Lenovo ThinkCentre Edge 72z`  
- **№ системн. блока** → `Электроника` → equipment.inventory_number (как есть; при необходимости нормализовать в «МЦ.04-Электроника» или синтетический)  
- **Дата закупки системного блока** → `2022 (б/у)` → purchase_date = NULL, в description  
- **Монитор, № монитора, дата закупки монитора, Имя, IP** → *(пусто)*  
- **ОС** → `Win10 Pro (x64)`, **Антивирус** → `KES11`

---

## Краткая сводка по неатомарным ячейкам (первые 10 строк)

| Строка | Столбец | Исходное значение | Приведено к атомарным | Куда грузится |
|--------|---------|-------------------|------------------------|---------------|
| 3 | Диск | SSD 480 ГБ\nHDD 500 ГБ | 1) SSD 480 ГБ 2) HDD 500 ГБ | part_char_values: 2 записи «Накопитель» |
| 9 | Монитор | AOC 24P2Q\nAOC 24P2Q | 1) AOC 24P2Q 2) AOC 24P2Q | part_char_values: 2 записи «Монитор» или 2 equipment |
| 9 | № монитора | МЦ.04\nМЦ.04 | 1) МЦ.04 2) МЦ.04 | part_char_values или 2 equipment с синтетическим инв. номером |
| 9 | Дата закупки монитора | 19.12.2022\n19.12.2022 | 1) 19.12.2022 2) 19.12.2022 | примечание или 2 записи |

**ЦП** во всех строках — атомарно (запятая в «3,3 ГГц» не разделитель).
