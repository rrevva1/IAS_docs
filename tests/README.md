# Тесты и проверка функционала ИАС

В данной папке собраны материалы для проверки функционала по модулям и тестовые данные.

## Структура

| Файл / папка | Назначение |
|--------------|------------|
| `ManualTestChecklist.md` | Чек-лист ручной проверки по модулям (Help Desk, пользователи, АРМ, ПО/лицензии, импорт, аудит). |
| `TEST_DATA_REGISTRY.md` | Реестр созданных тестовых данных: сущности, маркеры, скрипт удаления. Используйте его, чтобы удалить все тестовые записи из БД. |
| `seed_test_data.sql` | SQL-скрипт наполнения БД тестовыми данными (10–30 записей на сущность). Запуск: см. ниже. |
| `seed_software_licenses_only.sql` | Наполнение только разделов «ПО» и «Лицензии» (таблицы `software`, `licenses`). Требуется предварительно выполнить миграцию `m260213_120000_add_software_licenses`. |
| `seed_audit_only.sql` | Наполнение журнала аудита (таблица `audit_events`) — 25 тестовых записей. Записи в журнале защищены от удаления триггером; для тестовой БД при необходимости удаление возможно после отключения триггера. |

## Наполнение БД тестовыми данными

1. Убедитесь, что БД `ias_vniic` создана и схема `tech_accounting` развёрнута (например, выполнены `scripts/create_ias_vniic.sql` и миграции Yii2).
2. Для модуля **«ПО и лицензии»**: если таблицы `software` и `licenses` ещё не созданы, выполните миграции Yii2 (`cd ias_uch_vnii && php yii migrate`), затем при необходимости только ПО и лицензии можно заполнить отдельно:  
   `psql -U postgres -d ias_vniic -f tests/seed_software_licenses_only.sql`
3. Полное наполнение (все сущности):
   ```bash
   psql -U postgres -d ias_vniic -f tests/seed_test_data.sql
   ```
   Либо из корня проекта (если путь к `psql` настроен):
   ```bash
   psql -U postgres -d ias_vniic -f /Volumes/RR_main/8\ my_projects/TZ/tests/seed_test_data.sql
   ```

Все вставленные записи помечены маркерами (префиксы `SEED-`, `seed_user_`, «Тест. кабинет» и т.п.), чтобы их можно было безопасно удалить по реестру.

## Удаление тестовых данных

Откройте `TEST_DATA_REGISTRY.md`: в нём приведён порядок удаления и готовый SQL-скрипт. Выполните блоки удаления в указанном порядке (например, скопировав в `psql` или выполнив файл `tests/remove_test_data.sql` после его генерации).

## Запуск автоматических тестов (при наличии)

В проекте могут использоваться Codeception или PHPUnit. Если конфигурация настроена:

```bash
cd ias_uch_vnii
./vendor/bin/codecept run
# или
./vendor/bin/phpunit
```

Актуальные команды см. в `ias_uch_vnii/README.md` и `ias_uch_vnii/composer.json` (раздел `scripts`).
