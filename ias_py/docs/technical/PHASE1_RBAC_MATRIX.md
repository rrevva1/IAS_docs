# Фаза 1 — RBAC (матрица доступа)

Ниже — **фактические** роли/ограничения, которые видны из текущей БД `ias_vnii` и Yii2-кода, плюс **целевая** матрица для переноса (Django).

## 1) Роли в БД (ias_vnii)

По данным `public.roles`:
- `4` — `пользователь`
- `5` — `администратор`
- `6` — `оператор`

## 2) Фактические ограничения в текущем Yii2 (как есть)

### 2.1. Пользователи

`UsersController`:
- Не администратор (`identity->isAdmin()`) при заходе в список пользователей (`/users/index`) перенаправляется на `/users/view?id=current`.
- Обычный пользователь не может открыть `users/view` для чужого id (403).

### 2.2. Заявки

`TasksSearch`:
- Администратор (`identity->isAdministrator()` по имени роли) видит все заявки.
- Иначе видит только свои заявки (по `tasks.id_user = current_user_id`).

**Важно:** эндпоинты изменения статуса/исполнителя/комментария в `TasksController` не содержат явных RBAC-проверок — они доступны любому авторизованному пользователю (ограничение сейчас больше UI-уровнем).

## 3) Целевая матрица доступа для Django (рекомендуемая)

Обозначения:
- ✅ разрешено
- ❌ запрещено
- ✅* разрешено с доп. условиями

### 3.1. Модуль Help Desk (Tasks)

| Операция | пользователь | оператор | администратор |
|---|---:|---:|---:|
| Просмотр списка заявок | ✅* (только свои) | ✅ (все/по отделу — уточнить) | ✅ |
| Просмотр заявки | ✅* (свою) | ✅ | ✅ |
| Создание заявки | ✅ | ✅ | ✅ |
| Редактирование описания | ✅* (свою, пока не закрыта) | ✅* (по назначенным) | ✅ |
| Изменение статуса | ❌ (или ✅* только “Отменить свою”) | ✅* (по назначенным) | ✅ |
| Назначение исполнителя | ❌ | ✅* (если “оператор” = диспетчер) | ✅ |
| Редактирование комментария | ✅* (свою) | ✅* | ✅ |
| Удаление заявки | ❌ | ❌ (или ✅* по регламенту) | ✅ |

### 3.2. Вложения

| Операция | пользователь | оператор | администратор |
|---|---:|---:|---:|
| Загрузка вложений к заявке | ✅* (к своей) | ✅* | ✅ |
| Скачивание вложений | ✅* (если есть доступ к заявке) | ✅* | ✅ |
| Предпросмотр inline | ✅* (кроме опасных типов) | ✅* | ✅ |
| Удаление вложения | ✅* (если автор заявки и до закрытия) | ✅* | ✅ |

### 3.3. Активы/оборудование (Assets)

| Операция | пользователь | оператор | администратор |
|---|---:|---:|---:|
| Просмотр техники (закреплённой за пользователем) | ✅ (свою) | ✅ | ✅ |
| Добавление/редактирование техники | ❌ (или ✅* только себе) | ✅* | ✅ |
| Перемещение/смена локации | ❌ | ✅* | ✅ |

### 3.4. Управление пользователями

| Операция | пользователь | оператор | администратор |
|---|---:|---:|---:|
| Просмотр профиля | ✅ (свой) | ✅* | ✅ |
| Просмотр списка пользователей | ❌ | ✅* | ✅ |
| Создание/редактирование пользователя | ❌ | ❌/✅* | ✅ |
| Сброс пароля | ❌ | ❌ | ✅ |

## 4) Что нужно уточнить (в рамках анализа)

- Что означает роль **`оператор`** по бизнесу: диспетчер help desk? исполнитель? админ-оператор?  
  От этого зависит, какие права дать на “назначение исполнителя” и изменение статусов.

