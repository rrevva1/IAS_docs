# AG Grid - Автоматическая подстройка высоты таблицы

## Описание
Реализована система автоматической подстройки высоты таблицы AG Grid в зависимости от выбранного размера пагинации и размера окна браузера.

## Основные возможности

### 1. Фиксированная высота под 20 строк (по умолчанию)
- Таблица настроена на отображение **20 строк** по умолчанию
- Высота контейнера: **1235px** (расчет: 55px × 20 строк + заголовок + пагинация + отступы)

### 2. Динамическая подстройка высоты
При изменении размера страницы (10, 20, 50, 100 строк) таблица **автоматически** изменяет свою высоту:
- **10 строк**: ~685px
- **20 строк**: ~1235px
- **50 строк**: ~2885px (ограничена высотой окна)
- **100 строк**: ~5635px (ограничена высотой окна)

### 3. Умные ограничения
- **Минимальная высота**: 500px
- **Максимальная высота**: высота окна - 250px (место для заголовка и панели инструментов)
- **Адаптация при изменении размера окна**: автоматический пересчет

## Технические детали

### Формула расчета высоты
```javascript
высота = (высота_строки × количество_строк) + 
         высота_заголовка + 
         высота_пагинации + 
         высота_фильтров + 
         отступы
```

### Константы (определены в `/web/js/tasks/ag-grid.js`):
- `ROW_HEIGHT` = 55px - высота одной строки данных
- `HEADER_HEIGHT` = 55px - высота заголовка таблицы
- `PAGINATION_HEIGHT` = 60px - высота панели пагинации
- `FLOATING_FILTER_HEIGHT` = 40px (только для администраторов)
- `EXTRA_PADDING` = 20px - дополнительные отступы

## Измененные файлы

### 1. `/web/js/tasks/ag-grid.js`
**Добавлены функции:**
- `adjustGridHeight(pageSize)` - рассчитывает и устанавливает высоту контейнера
- `onPaginationChanged(params)` - обработчик изменения пагинации
- Обработчик `window.resize` - пересчет при изменении размера окна

**Изменения в конфигурации:**
```javascript
gridOptions = {
    // ...
    onPaginationChanged: onPaginationChanged, // новый обработчик
}
```

### 2. `/web/css/tasks/ag-grid.css`
**Обновлен контейнер:**
```css
#agGridTasksContainer {
    height: 1235px; /* начальная высота под 20 строк */
    min-height: 500px;
    transition: height 0.3s ease; /* плавный переход */
}
```

## Как это работает

1. **При загрузке страницы**: вызывается `adjustGridHeight()` в `onGridReady()`
2. **При изменении размера страницы**: срабатывает `onPaginationChanged()`
3. **При изменении размера окна**: срабатывает обработчик `window.resize` (с debounce 250мс)
4. **Плавная анимация**: CSS transition создает плавный эффект изменения высоты

## Настройка

### Изменить количество строк по умолчанию
В файле `/web/js/tasks/ag-grid.js`, строка 122:
```javascript
paginationPageSize: 20, // измените на нужное значение
```

### Изменить варианты выбора размера страницы
В файле `/web/js/tasks/ag-grid.js`, строка 123:
```javascript
paginationPageSizeSelector: [10, 20, 50, 100], // добавьте нужные значения
```

### Изменить минимальную/максимальную высоту
В функции `adjustGridHeight()` измените:
```javascript
const minHeight = 500; // минимальная высота
const maxHeight = windowHeight - 250; // отступ от верха
```

### Отключить плавный переход
В файле `/web/css/tasks/ag-grid.css` удалите строку:
```css
transition: height 0.3s ease;
```

### Отключить автоматическую подстройку
Удалите или закомментируйте в `gridOptions`:
```javascript
// onPaginationChanged: onPaginationChanged,
```

## Отладка

В консоли браузера (F12) отображаются логи:
```
AG Grid: Автоподстройка высоты {
    pageSize: 20,
    calculatedHeight: 1235,
    maxHeight: 1520,
    resultHeight: 1235
}
```

Для отключения логов удалите `console.log` в функции `adjustGridHeight()`.

## Совместимость
- ✅ Работает на всех современных браузерах
- ✅ Адаптивна для мобильных устройств
- ✅ Учитывает роли пользователей (администратор/обычный пользователь)
- ✅ Оптимизирована производительность (debounce для resize)

## Примеры использования

### Для администраторов
- Floating фильтры добавляют 40px к высоте
- Доступны все размеры страниц: 10, 20, 50, 100

### Для обычных пользователей
- Без floating фильтров (меньше высота)
- Доступны все размеры страниц: 10, 20, 50, 100

## Рекомендации
- Используйте **20 строк** для оптимального баланса между информативностью и скоростью загрузки
- Для больших мониторов можно использовать **50 строк**
- Для мобильных устройств рекомендуется **10 строк**

---

**Дата создания**: 3 ноября 2025  
**Версия**: 1.0  
**Статус**: Активно используется

