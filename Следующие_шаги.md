Ниже — развернутые пояснения по пунктам 1, 3, 4, 5 и формализованный статус. Пункт 2 зафиксирован как «отложено до принятия решений».

## 1. Закрытие неопределенностей этапа 1 (детализация)

Что именно нужно зафиксировать в проектной документации:

### Роль «оператор»

- Функции роли: прием заявок, первичная классификация, назначение исполнителя, контроль сроков, закрытие заявки, доступ к карточкам активов.
- Права на данные: доступ ко всем заявкам или только к «своим»/«своего подразделения».
- Ограничения: право удаления заявки, право скачивания вложений, право редактирования карточки актива.
- Артефакт фиксации: матрица доступа и краткое описание роли в SYSTEM_DESCRIPTION.md и разделе 7.1.5 TZ.md (или отдельный документ «Роли и права доступа»).

### Режим AG Grid (клиентский/серверный)

- Клиентский режим: выдача всех записей без серверной пагинации; фильтрация и сортировка на клиенте; риск по производительности при росте объема.
- Серверный режим: параметры page/size/sort/filter обрабатываются на сервере; требуется спецификация API и индексы БД.
- Артефакт фиксации: спецификация API (раздел 7.1.6 TZ.md + отдельная спецификация интерфейсов).

### Целевая схема для импорта «arm» vs расширенная схема

- Вариант A: расширение текущей таблицы arm под поля листа АРМ (инв. номер, тип, поставщик, даты, статус и др.).
- Вариант B: переход на целевую схему equipment (по scripts/create_ias_vniic.sql и docs/bd/МОДЕЛЬ_БД_ias_vniic.md).
- Критерий выбора: полнота покрытия столбцов «Основного учета», требования к карточке актива и план импорта.
- Артефакт фиксации: решение в docs/bd/ОСНОВНОЙ_УЧЕТ_И_БД.md + обновление docs/bd/МОДЕЛЬ_БД_ias_vniic.md.

Результат закрытия этапа 1: однозначные правила роли «оператор», режим AG Grid, целевая схема импорта, зафиксированные в проектной документации и исключающие противоречия.

## 2. Нулевая волна безопасности — отложено

Пункт фиксируется как отложенный до согласования и принятия решения. Приоритетность сохраняется из-за требований по безопасности (пароли, права, вложения, SVG).

## 3. Права по заявкам + задел под аудит (детализация)

### Централизованные проверки доступа в TasksController:

Единый метод проверки, например canUserAccessTask($task) с правилами:

- автор заявки;
- исполнитель (если назначен);
- администратор (полный доступ);
- роль «оператор» — после фиксации в матрице прав.

Проверка должна применяться к операциям:

- просмотр, редактирование, удаление заявки;
- изменение статуса и исполнителя;
- изменение комментария;
- работа с вложениями (download/preview/delete).

### Задел под аудит:

- Таблица audit_events (по scripts/create_ias_vniic.sql).
- Минимальный набор полей: дата/время, пользователь, тип операции, объект, результат, контекст.
- Минимальный набор событий:
  - операции управления пользователями;
  - удаление/изменение заявок;
  - операции с вложениями;
  - изменения карточек активов.

Результат: обеспечена проверка прав на все операции по заявкам и заложен единый механизм фиксации аудита для критичных событий.

## 4. Карточка актива (детализация)

Минимальный объем работ:

- Реализация view/update для активов (ArmController).
- Вывод и редактирование основных атрибутов (инв. номер, тип, локация, ответственный, даты).
- Подключение конфигурации через part_char_values (модель + вывод значений).
- Базовая история изменений (таблица истории и запись при создании/обновлении).

Приведение схемы под лист АРМ:

- Выбор: расширить arm полями или использовать equipment из целевой схемы.
- От этого зависит маппинг Excel → БД и реализация импорта.

Результат: карточка актива становится функциональной, поддерживает историю и достаточна для импорта из «Основного учета».

## 5. Импорт из «Основной Учет.xlsx» — что имеется в виду (детализация)

Суть: реализовать воспроизводимый загрузчик, работающий по регламенту docs/РЕГЛАМЕНТ_ПАРСИНГА_ОУ_ТЕСТ.md и обеспечивающий протокол импорта.

Ключевые элементы:

- Маппинг полей: строго по регламенту (лист АРМ, приоритет разделителей, правила дат).
- Нормализация: пользователи, локации, справочники частей/характеристик.
- Валидация: дубликаты по инв. номеру, отсутствие пользователя/локации, некорректные даты.
- Протокол импорта: количество строк, количество ошибок, перечень ошибок (строка, причина).
- Контрольные сверки на ОУ_тест: сравнение числа записей, выборочная проверка по инв. номерам и локациям.

Результат: загрузка выполняется повторяемо, с журналированием, и подтверждается контрольными сверками.

## Формализованный статус (по артефактам и реализации)

### 1) Документация и проектные решения

| Область | Статус | Комментарий |
|---|---|---|
| ТЗ (TZ.md) | Готово | Полный базовый документ |
| Требования (docs/sistema/ТРЕБОВАНИЯ_К_СИСТЕМЕ.md) | Готово | Вынесены из ТЗ |
| Описание системы (SYSTEM_DESCRIPTION.md) | Готово | Есть контуры и риски |
| Модель БД (docs/bd/МОДЕЛЬ_БД_ias_vniic.md) | Готово | Целевая схема определена |
| Регламент парсинга ОУ_тест | Готово | Подробные правила |
| Спецификация API | Не начато | Требуется фиксация |
| Матрица прав (вкл. оператор) | Не начато | Требует решения |
| Решение по схеме импорта | Не принято | arm vs equipment |

### 2) Реализация по контурам

| Контур | Статус | Комментарий |
|---|---|---|
| Пользователи/роли/доступ | Частично | Есть базовый CRUD, но есть риски ИБ |
| Help Desk (заявки) | Частично | CRUD есть, права не централизованы |
| Вложения | Частично | Работает, но связь и безопасность не нормализованы |
| Активы (карточка) | Частично | Есть список и создание, нет view/update |
| Конфигурация (part_char_values) | Не реализовано | Нет моделей/таблиц |
| Связь заявка–актив | Не реализовано | Нет схемы и UI |
| Аудит | Не реализовано | Таблица не используется |
| Импорт XLSX | Не реализовано | Есть регламент, нет рабочего загрузчика |
| ПО и лицензии | Не реализовано | Контур не реализован |
| Отчетность/экспорт | Частично | Excel есть, остальное нет |

### 3) Статус этапов по плану

| Этап | Статус | Основание |
|---|---|---|
| 1. Обследование и уточнение требований | Частично | Не закрыты роль «оператор», AG Grid, схема импорта |
| 2. Проектные решения | Частично | Модель БД есть, API/доступы не зафиксированы |
| 3. Разработка | Частично | Реализовано ядро Help Desk, активы — частично |
| 4. Миграция/импорт | Частично | Регламенты есть, реализация отсутствует |
| 5. Испытания | Не начато | Нет протоколов |
| 6. Документация/обучение | Не начато | Не оформлены руководства |
| 7. Ввод в эксплуатацию | Не начато | Нет регламентов/приемки |

Если нужен вариант в виде отдельного документа (например, «Отчет о статусе проекта») — подготовлю файл с нумерацией разделов и формализованными формулировками.